# Деплой на Render

Инструкция по развертыванию приложения мониторинга успеваемости на Render.

## Предварительные требования

1. Аккаунт на [Render.com](https://render.com)
2. Репозиторий на GitHub/GitLab/Bitbucket (или используйте прямую загрузку)

## Шаги для деплоя

### 1. Подготовка репозитория

Убедитесь, что все файлы закоммичены и запушены в ваш репозиторий:
- `app.py`
- `requirements.txt`
- `render.yaml`
- `build.sh`
- Все остальные необходимые файлы

### 2. Создание сервиса на Render

1. Войдите в [Render Dashboard](https://dashboard.render.com)
2. Нажмите "New +" → "Web Service"
3. Подключите ваш репозиторий
4. Render автоматически обнаружит `render.yaml` и использует его конфигурацию

### 3. Настройка переменных окружения

В настройках сервиса (Environment) добавьте следующие переменные:

- `EDUS_LOGIN` - ваш логин для входа в систему mektep.edu.kz (обязательно для автоматической авторизации)
- `EDUS_PASSWORD` - ваш пароль (обязательно для автоматической авторизации)
- `HEADLESS=true` - уже установлено в render.yaml, но можно переопределить
- `SECRET_KEY` - автоматически генерируется Render

**Важно**: Если `EDUS_LOGIN` и `EDUS_PASSWORD` установлены, приложение будет использовать автоматическую авторизацию. Это необходимо для работы на Render, так как в headless режиме невозможно открыть браузер для ручной авторизации.

### 4. Настройки сборки

Render автоматически использует:
- **Build Command**: `chmod +x build.sh && ./build.sh`
- **Start Command**: `gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --threads 2 --timeout 300`

### 5. Деплой

После настройки нажмите "Create Web Service". Render:
1. Установит системные зависимости (Chrome/Chromium)
2. Установит Python зависимости
3. Запустит приложение

## Важные замечания

### Таймауты

Приложение использует длительные операции (скрапинг данных), поэтому:
- Таймаут установлен на 300 секунд (5 минут)
- Для очень больших объемов данных может потребоваться увеличение таймаута

### Chrome/Chromium

Приложение автоматически устанавливает Chrome во время сборки через `build.sh`. Если возникнут проблемы:
- Проверьте логи сборки
- Убедитесь, что `build.sh` имеет права на выполнение

### Переменные окружения

**ВАЖНО**: Не коммитьте файл `.env` с реальными учетными данными! Используйте переменные окружения в настройках Render.

### Файлы

Временные файлы (Excel) сохраняются в папке `uploads/`. На Render это эфемерная файловая система, поэтому:
- Файлы удаляются при перезапуске сервиса
- Для постоянного хранения рассмотрите использование облачного хранилища (S3, etc.)

## Проверка работы

После деплоя:
1. Откройте URL вашего сервиса (например, `https://your-app.onrender.com`)
2. Проверьте, что интерфейс загружается
3. Протестируйте запуск скрапера

## Обновление

Для обновления приложения:
1. Внесите изменения в код
2. Закоммитьте и запушьте в репозиторий
3. Render автоматически запустит новый деплой

## Поддержка

При возникновении проблем:
1. Проверьте логи в Render Dashboard
2. Убедитесь, что все переменные окружения установлены
3. Проверьте, что Chrome установлен корректно (логи сборки)

