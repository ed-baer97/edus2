<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мониторинг успеваемости</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> Мониторинг успеваемости</h1>
            <p class="subtitle">Извлечение данных с сайта mektep.edu.kz</p>
        </header>

        <div class="wizard-container">
            <!-- Шаг 0: Авторизация -->
            <div class="step active" id="step-0">
                <div class="step-header">
                    <div class="step-number">0</div>
                    <div class="step-title">
                        <h2>Вход в систему</h2>
                        <p>Введите ваши учетные данные для доступа к mektep.edu.kz</p>
                    </div>
                </div>
                <div class="step-content">
                    <div class="auth-form-container">
                        <form id="auth-form" onsubmit="saveCredentials(event)">
                            <div class="form-group">
                                <label for="login-input">
                                    <i class="fas fa-user"></i> Логин (Email)
                                </label>
                                <input 
                                    type="text" 
                                    id="login-input" 
                                    name="login" 
                                    placeholder="Введите ваш логин или email"
                                    required
                                    autocomplete="username"
                                >
                            </div>
                            <div class="form-group">
                                <label for="password-input">
                                    <i class="fas fa-lock"></i> Пароль
                                </label>
                                <input 
                                    type="password" 
                                    id="password-input" 
                                    name="password" 
                                    placeholder="Введите ваш пароль"
                                    required
                                    autocomplete="current-password"
                                >
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary btn-large" id="save-credentials-btn">
                                    <i class="fas fa-save"></i> Сохранить и продолжить
                                </button>
                            </div>
                            <div id="credentials-status" class="status-box" style="display: none; margin-top: 15px;">
                                <i class="fas fa-check-circle"></i>
                                <span>Учетные данные сохранены</span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Шаг 1: Запуск -->
            <div class="step" id="step-1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">
                        <h2>Запуск процесса</h2>
                        <p>Нажмите кнопку для начала извлечения данных</p>
                    </div>
                </div>
                <div class="step-content">
                    <div class="status-box" id="status-box">
                        <i class="fas fa-info-circle"></i>
                        <span>Готов к запуску</span>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary btn-large" id="start-btn" onclick="startProcess()">
                            <i class="fas fa-play"></i> Запустить
                        </button>
                        <button class="btn btn-secondary btn-large" id="restart-btn" onclick="restartProcess()" style="display: none;">
                            <i class="fas fa-redo"></i> Перезапустить
                        </button>
                    </div>
                    <div class="progress-container" id="progress-container" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">0%</div>
                    </div>
                </div>
            </div>

            <!-- Шаг 2: Выбор школы -->
            <div class="step" id="step-2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">
                        <h2>Выбор школы</h2>
                        <p>Выберите школу из списка</p>
                    </div>
                </div>
                <div class="step-content">
                    <div id="schools-loading" class="loading-box">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Загрузка списка школ...</span>
                    </div>
                    <div id="schools-list" class="selection-grid"></div>
                </div>
            </div>

            <!-- Шаг 3: Выбор класса -->
            <div class="step" id="step-3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">
                        <h2>Выбор класса</h2>
                        <p>Выберите класс из списка</p>
                    </div>
                </div>
                <div class="step-content">
                    <div id="classes-loading" class="loading-box">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Загрузка списка классов...</span>
                    </div>
                    <div id="classes-list" class="selection-grid"></div>
                </div>
            </div>

            <!-- Шаг 4: Скачивание -->
            <div class="step" id="step-4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">
                        <h2>Скачивание файлов</h2>
                        <p>Скачайте обработанные данные</p>
                    </div>
                </div>
                <div class="step-content">
                    <div id="download-status" class="status-box success">
                        <i class="fas fa-check-circle"></i>
                        <span>Данные успешно обработаны!</span>
                    </div>
                    <div id="files-container" class="files-container">
                        <div class="loading-box">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Загрузка списка файлов...</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="restartProcess()">
                        <i class="fas fa-redo"></i> Начать заново
                    </button>
                </div>
            </div>
        </div>

        <!-- Логи (сворачиваемая панель) -->
        <div class="logs-panel">
            <div class="logs-header" onclick="toggleLogs()">
                <span><i class="fas fa-terminal"></i> Логи выполнения</span>
                <i class="fas fa-chevron-down" id="logs-chevron"></i>
            </div>
            <div class="logs-content" id="logs-content">
                <div id="logs-container" class="logs-container"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
